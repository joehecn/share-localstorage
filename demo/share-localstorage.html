
<script>
  window.addEventListener('message', onMessage)
  
  function onMessage(e) {
    try {
      const data = JSON.parse(e.data)
    
      switch (data.method) {
        case 'getItem':
          {
            const { id, keyName } = data
            const keyValue = localStorage.getItem(keyName)
            e.ports[0].postMessage(JSON.stringify({ id, keyValue }))
          }
          break
        
        case 'setItem':
          {
            const { id, keyName, keyValue } = data
            localStorage.setItem(keyName, keyValue)
            e.ports[0].postMessage(JSON.stringify({ id }))
          }
          break
  
        case 'removeItem':
          {
            const { id, keyName } = data
            localStorage.removeItem(keyName)
            e.ports[0].postMessage(JSON.stringify({ id }))
          }
          break
        default:
          break
      }
    } catch (error) {
      console.error(error)
      const code = error.code || 10000
      const message = error.message || 'unknown error'
      e.ports[0].postMessage(JSON.stringify({ id, code, message }))
    }
  }
  </script>
  